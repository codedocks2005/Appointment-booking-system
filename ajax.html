<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Appointment Booking</title>
    <link rel="stylesheet" href="booking.css">
    <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
</head>
<body>
    <header>
        <div class="nav">          
        <img src="final1-removebg-preview.png" alt="final1-removebg-preview.png">
    
        <button id="home" onclick="location.href='Homepage.html'">Home</button>
        <button id="login" onclick="location.href='loginpage.html'">Login</button>
        <button id="dashboard" onclick="location.href='Dashboard.html'">Dashboard</button>
        <button id="booking">Booking</button>
        <button id="payment">Payment</button>
        <button id="contact1">Contact</button>
        </div>
    </header>

    <div id="mainbox1">
        ww<h2>Select Services:</h2>
        <label for="service1"><input type="radio" name="service" id="service1" value="clinic"> Clinic</label><br>
        <label for="service2"><input type="radio" name="service" id="service2" value="haircut"> Haircut</label><br>
        <label for="service3"><input type="radio" name="service" id="service3" value="spa"> Spa</label><br>
        <label for="service4"><input type="radio" name="service" id="service4" value="eye_checkup"> Eye checkup</label><br>
    </div>
     
    <div id="mainbox2">
        <h2>Select Date:</h2>
        <div id="calendar"></div>
    </div>

    <div id="mainbox3">
    <h2>Select Time:</h2>
        <input type="time" id="time" name="time">
    </div>

    <div id="mainbox4">
        <h2>Select Provider:</h2>
        <select id="provider">
            <!-- Providers will be dynamically populated based on service -->
        </select>
    </div>

    <div id="confirm-button">
        <button id="confirm">Confirm Appointment</button>
    </div>

    <footer>
        <div id="foot-box">
            <p id="copyright">Copyright &copy; 2023 - All Rights Reserved - <a href="#" style="color: whitesmoke;">Terms and Conditions</a></p>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            var calendarEl = document.getElementById('calendar');
            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                selectable: true,
                headerToolbar: {
                    start: 'prev,next today', 
                    center: 'title',
                    end: 'dayGridMonth,timeGridWeek,timeGridDay',
                },
                themeSystem: 'standard',
                height: 400,
                dateClick: function(info) {
                    document.getElementById("calendar-date").value = info.dateStr;
                }
            });
            calendar.render();
        });

        document.querySelectorAll('input[name="service"]').forEach((radio) => {
            radio.addEventListener('change', function() {
                var selectedService = document.querySelector('input[name="service"]:checked')?.value;
                if (selectedService) {
                    fetchProviders(selectedService); 
                }
            });
        });

        function fetchProviders(service) {
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "fetch_providers.php?service=" + service, true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    var providers = JSON.parse(xhr.responseText);
                    var providerSelect = document.getElementById("provider");
                    providerSelect.innerHTML = "";
                    providers.forEach(function(provider) {
                        var option = document.createElement("option");
                        option.value = provider.id;
                        option.textContent = provider.name;
                        providerSelect.appendChild(option);
                    });
                }
            };
            xhr.send();
        }

     document.getElementById("confirm").addEventListener("click", function() {
            var selectedService = document.querySelector('input[name="service"]:checked')?.value;
            var selectedDate = document.getElementById("calendar-date").value;
            var selectedTime = document.getElementById("time").value;
            var selectedProvider = document.getElementById("provider").value;

            if (selectedService && selectedDate && selectedTime && selectedProvider) {
                var appointmentData = {
                    service: selectedService,
                    date: selectedDate,
                    time: selectedTime,
                    provider_id: selectedProvider
                };

                var xhr = new XMLHttpRequest();
                xhr.open("POST", "confirm_appointment.php", true);
                xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                xhr.onreadystatechange = function() {
                    if (xhr.readyState === 4 && xhr.status === 200) {
                        var response = JSON.parse(xhr.responseText);
                        alert(response.message);
                    }
                };

                xhr.send("data=" + JSON.stringify(appointmentData));
            } else {
                alert("Please fill all fields clearlyaddwC.");
            }
        });
    </script>

</body>
</html>
